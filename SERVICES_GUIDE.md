# ğŸš€ è©æ¬ºåµæ¸¬ç³»çµ±å®Œæ•´æœå‹™æŒ‡å—

## ğŸ“‹ æœå‹™æ¦‚è¦½

æœ¬ç³»çµ±åŒ…å«ä»¥ä¸‹6å€‹æ ¸å¿ƒæœå‹™ï¼š

| æœå‹™åç¨± | å®¹å™¨åç¨± | ç«¯å£ | æè¿° |
|---------|---------|------|------|
| **è©æ¬ºåµæ¸¬API** | `fraud-api` | 8000 | FastAPIæœå‹™ï¼Œæä¾›è©æ¬ºé æ¸¬åŠŸèƒ½ |
| **Streamlit Dashboard** | `fraud-dashboard` | 8501 | äº’å‹•å¼å„€è¡¨æ¿ï¼Œæ¨¡å‹ç›£æ§å’Œé æ¸¬ |
| **PostgreSQL** | `postgres_db` | 5432 | ä¸»è¦è³‡æ–™åº« |
| **MLflowè¿½è¹¤æœå‹™** | `mlflow_server` | 5000 | æ©Ÿå™¨å­¸ç¿’å¯¦é©—è¿½è¹¤ |
| **Adminer** | `adminer` | 8080 | è³‡æ–™åº«ç®¡ç†ä»‹é¢ |
| **ETLæœå‹™** | `etl_runner` | - | ä¸€æ¬¡æ€§åŸ·è¡Œçš„æ•¸æ“šè™•ç†å’Œæ¨¡å‹è¨“ç·´ |

## ğŸ”§ ä¿®æ­£é …ç›®

### 1. **Dockerfile.api ä¾è³´ä¿®æ­£**
âœ… æ·»åŠ äº†æ‰€æœ‰å¿…è¦å¥—ä»¶ï¼š
- `xgboost` - æ©Ÿå™¨å­¸ç¿’æ¨¡å‹
- `sqlalchemy` - è³‡æ–™åº«é€£æ¥
- `psycopg2-binary` - PostgreSQLé©…å‹•
- `mlflow` - æ¨¡å‹ç‰ˆæœ¬ç®¡ç†

### 2. **è·¯å¾‘é…ç½®ä¿®æ­£**
âœ… çµ±ä¸€ä½¿ç”¨å®¹å™¨å…§çµ•å°è·¯å¾‘ï¼š
- æ¨¡å‹è·¯å¾‘ï¼š`/app/src/models/`
- è³‡æ–™è·¯å¾‘ï¼š`/app/data/`

### 3. **APIæ¨¡å‹è¼‰å…¥ç­–ç•¥**
âœ… æ”¹é€²çš„æ¨¡å‹è¼‰å…¥æµç¨‹ï¼š
- å„ªå…ˆå¾MLflowè¼‰å…¥æœ€æ–°æ¨¡å‹
- å¤±æ•—æ™‚å›é€€åˆ°æœ¬åœ°æª”æ¡ˆ
- æ”¯æ´ç’°å¢ƒè®Šæ•¸é…ç½®

### 4. **æ•¸æ“šç®¡é“å®Œæ•´æ€§**
âœ… å®Œæ•´çš„ETLæµç¨‹ï¼š
- æ•¸æ“šè¼‰å…¥æœå‹™ (`data_loader`)
- ç‰¹å¾µè¦–åœ–å‰µå»º
- è‡ªå‹•åŒ–è¨“ç·´æµç¨‹

### 5. **DashboardåŠŸèƒ½å¢å¼·**
âœ… æ”¹é€²çš„å„€è¡¨æ¿åŠŸèƒ½ï¼š
- MLflowå¯¦é©—è¿½è¹¤æ•´åˆ
- æ¨¡å‹æ€§èƒ½æ¯”è¼ƒ
- å¯¦æ™‚é æ¸¬ä»‹é¢
- éŒ¯èª¤è™•ç†æ©Ÿåˆ¶

## ğŸš€ å¿«é€Ÿå•Ÿå‹•

### æ–¹æ³•1ï¼šä½¿ç”¨è‡ªå‹•åŒ–è…³æœ¬

**Windowsç”¨æˆ¶ï¼š**
```batch
start_services.bat
```

**Linux/Macç”¨æˆ¶ï¼š**
```bash
chmod +x start_services.sh
./start_services.sh
```

### æ–¹æ³•2ï¼šæ‰‹å‹•æ­¥é©Ÿå•Ÿå‹•

```bash
cd docker

# 1. å•Ÿå‹•åŸºç¤æœå‹™
docker-compose up -d postgres_db mlflow_server

# 2. ç­‰å¾…è³‡æ–™åº«å°±ç·’
sleep 10

# 3. è¼‰å…¥åŸå§‹æ•¸æ“š
docker-compose run --rm data_loader

# 4. åŸ·è¡ŒETLå’Œæ¨¡å‹è¨“ç·´
docker-compose run --rm etl_runner

# 5. å•Ÿå‹•æ‡‰ç”¨æœå‹™
docker-compose up -d fraud_api fraud_dashboard adminer
```

## ğŸ” æœå‹™æ¸¬è©¦

### è‡ªå‹•åŒ–æ¸¬è©¦
```bash
python test_services.py
```

### æ‰‹å‹•æ¸¬è©¦

**1. APIæœå‹™æ¸¬è©¦**
```bash
# åŸºæœ¬å¥åº·æª¢æŸ¥
curl http://localhost:8000/

# APIæ–‡æª”
# ç€è¦½å™¨é–‹å•Ÿ: http://localhost:8000/docs
```

**2. é æ¸¬åŠŸèƒ½æ¸¬è©¦**
```bash
curl -X POST "http://localhost:8000/predict" \
  -H "Content-Type: application/json" \
  -d '{
    "time": 45000.0,
    "amount": 120.50,
    "v1": -0.96, "v2": 1.24, "v3": -1.0, "v4": 0.0, "v5": -0.1,
    "v6": 0.0, "v7": 0.0, "v8": 0.0, "v9": 0.5, "v10": 0.0,
    "v11": 0.0, "v12": 0.0, "v13": 0.0, "v14": 0.0, "v15": 0.0,
    "v16": 0.0, "v17": 0.0, "v18": 0.0, "v19": 0.0, "v20": 0.0,
    "v21": 0.0, "v22": 0.0, "v23": 0.0, "v24": 0.0, "v25": 0.0,
    "v26": 0.0, "v27": 0.0, "v28": 0.0
  }'
```

**é æœŸå›æ‡‰ï¼š**
```json
{
  "is_fraud": 0,
  "fraud_probability": 0.1234,
  "message": "Transaction analyzed successfully."
}
```

## ğŸŒ æœå‹™è¨ªå•

| æœå‹™ | URL | ç”¨é€” |
|------|-----|------|
| **APIæœå‹™** | http://localhost:8000 | REST APIç«¯é» |
| **APIæ–‡æª”** | http://localhost:8000/docs | Swaggeräº’å‹•æ–‡æª” |
| **Dashboard** | http://localhost:8501 | æ¨¡å‹ç›£æ§å’Œé æ¸¬ä»‹é¢ |
| **MLflow** | http://localhost:5000 | å¯¦é©—è¿½è¹¤å’Œæ¨¡å‹ç®¡ç† |
| **Adminer** | http://localhost:8080 | è³‡æ–™åº«ç®¡ç† |

### Adminerç™»å…¥è³‡è¨Š
- **ç³»çµ±**: PostgreSQL
- **ä¼ºæœå™¨**: postgres_db
- **ä½¿ç”¨è€…åç¨±**: user
- **å¯†ç¢¼**: password
- **è³‡æ–™åº«**: fraud_db

## ğŸ› ï¸ ç–‘é›£æ’è§£

### å¸¸è¦‹å•é¡Œ

**1. æ¨¡çµ„ç¼ºå¤±éŒ¯èª¤**
```
ModuleNotFoundError: No module named 'xgboost'
```
âœ… **è§£æ±ºæ–¹æ¡ˆ**: é‡æ–°å»ºæ§‹Dockeræ˜ åƒ
```bash
cd docker
docker-compose build --no-cache fraud_api
```

**2. è³‡æ–™åº«é€£ç·šå¤±æ•—**
```
connection to server failed
```
âœ… **è§£æ±ºæ–¹æ¡ˆ**: ç¢ºèªPostgreSQLå®¹å™¨é‹è¡Œä¸”å¥åº·
```bash
docker-compose ps postgres_db
docker-compose logs postgres_db
```

**3. MLflowé€£ç·šå•é¡Œ**
```
é€£ç·šåˆ°MLflowå¤±æ•—
```
âœ… **è§£æ±ºæ–¹æ¡ˆ**: æª¢æŸ¥MLflowæœå‹™ç‹€æ…‹
```bash
docker-compose logs mlflow_server
curl http://localhost:5000
```

**4. APIæ¨¡å‹è¼‰å…¥å¤±æ•—**
```
Model not loaded
```
âœ… **è§£æ±ºæ–¹æ¡ˆ**: ç¢ºä¿ETLæµç¨‹å·²å®Œæˆ
```bash
docker-compose run --rm etl_runner
```

### æª¢æŸ¥æœå‹™ç‹€æ…‹
```bash
cd docker
docker-compose ps
docker-compose logs [service_name]
```

### å®Œå…¨é‡ç½®
```bash
cd docker
docker-compose down -v
docker-compose build --no-cache
# ç„¶å¾Œé‡æ–°å•Ÿå‹•æœå‹™
```

## ğŸ“Š ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Dashboard     â”‚    â”‚      API        â”‚    â”‚    MLflow       â”‚
â”‚   (Streamlit)   â”‚â—„â”€â”€â–ºâ”‚   (FastAPI)     â”‚â—„â”€â”€â–ºâ”‚   Tracking      â”‚
â”‚   Port: 8501    â”‚    â”‚   Port: 8000    â”‚    â”‚   Port: 5000    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   PostgreSQL    â”‚    â”‚    Adminer      â”‚
                    â”‚   (Database)    â”‚â—„â”€â”€â–ºâ”‚  (DB Manager)   â”‚
                    â”‚   Port: 5432    â”‚    â”‚   Port: 8080    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æ¨¡å‹å„ªåŒ–**: èª¿æ•´XGBooståƒæ•¸æå‡æ€§èƒ½
2. **ç›£æ§å¢å¼·**: æ·»åŠ æ¨¡å‹æ€§èƒ½ç›£æ§è­¦å ±
3. **å®‰å…¨å¼·åŒ–**: å¯¦æ–½APIèªè­‰å’Œæˆæ¬Š
4. **æ“´å±•éƒ¨ç½²**: é…ç½®ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²æµç¨‹

---

**âœ… ç³»çµ±å·²å®Œå…¨é…ç½®ä¸¦å¯æ­£å¸¸é‹ä½œï¼**
